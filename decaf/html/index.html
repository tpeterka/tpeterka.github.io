<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Decaf: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Decaf
   </div>
   <div id="projectbrief">decoupled dataflows for in-situ high performance workflows</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Decaf Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This document uses the <a href="http://daringfireball.net/projects/markdown/">Markdown</a> syntax.</p>
<h1>Decaf dependencies</h1>
<ul>
<li>C++11</li>
<li>MPI-3</li>
<li>Boost 1.59 or higher</li>
<li>Python 2.7</li>
<li>Networkx 2.0</li>
<li>CMake 3.0 or higher</li>
<li>CCI 2.1 or higher (optional)</li>
</ul>
<p>The following is an example of commands to install the various dependencies of Decaf on a Linux system. In this example, the dependencies installed from source are built in the folder <code>$HOME/software</code> and installed in <code>$HOME/software/install</code>. The example installs OpenMPI but any MPI package supporting MPI 3.0 can be used.</p>
<div class="fragment"><div class="line">sudo apt-get install git</div><div class="line">sudo apt-get install cmake</div><div class="line">sudo apt-get install python-pip</div><div class="line"></div><div class="line"># Minimum OpenMPI version: 1.8</div><div class="line">sudo apt-get install openmpi-common</div><div class="line">sudo apt-get install openmpi-bin</div><div class="line">sudo apt-get install libopenmpi-dev</div><div class="line"></div><div class="line">cd $HOME</div><div class="line">mkdir software</div><div class="line">cd software</div><div class="line">mkdir install</div><div class="line"></div><div class="line">export PATH=$HOME/software/install/include:$HOME/software/install/bin:$PATH</div><div class="line">export LD_LIBRARY_PATH=$HOME/software/install/lib:$LD_LIBRARY_PATH</div><div class="line"></div><div class="line"># Boost</div><div class="line">cd $HOME/software</div><div class="line">wget https://dl.bintray.com/boostorg/release/1.64.0/source/boost_1_64_0.tar.gz</div><div class="line">tar -xf boost_1_64_0.tar.gz</div><div class="line">cd boost_1_64_0</div><div class="line">./bootstrap.sh --prefix=$HOME/software/install/</div><div class="line">./b2 install</div><div class="line"></div><div class="line"># NetworkX</div><div class="line">pip install networkx</div><div class="line"></div><div class="line"># Optional: CCI</div><div class="line">cd $HOME/software</div><div class="line">wget http://cci-forum.com/wp-content/uploads/2017/05/cci-2.1.tar.gz</div><div class="line">tar -xf cci-2.1.tar.gz</div><div class="line">cd cci-2.1</div><div class="line">./configure --prefix=$HOME/software/install</div><div class="line">make -j4 install</div></div><!-- fragment --><h1>Building Decaf:</h1>
<p>Retrieve the sources of Decaf (in the current directory, e.g.): </p><div class="fragment"><div class="line">git clone https://bitbucket.org/tpeterka1/decaf.git .</div></div><!-- fragment --><p>Decaf is built using CMake. Assuming that you created a build directory, then: </p><div class="fragment"><div class="line">cd path/to/decaf/build</div></div><!-- fragment --><p>Currently, the available options are:</p>
<ul>
<li>transport_mpi "Build Decaf with MPI transport layer" ON/OFF, default ON</li>
<li>transport_cci "Build Decaf with CCI transport layer" ON/OFF, default OFF</li>
<li>build_bredala "Build Bredala libraries and examples" ON/OFF, default ON</li>
<li>build_manala "Build Manala libraries and examples" ON/OFF, default ON</li>
<li>build_decaf "Build the Decaf workflow system" ON/OFF, default ON</li>
<li>build_tests "Build the tests examples" ON/OFF, default ON</li>
</ul>
<div class="fragment"><div class="line">{transport_mpi```}</div><div class="line">currently supported by Decaf. At least one transport method must be turned on,</div><div class="line">but more than one are allowed if different parts of the workflow graph use</div><div class="line">different methods.</div><div class="line">The Decaf project is composed of three parts: Bredala, a data model and</div><div class="line">transport library, Manala, a library managing the flow of messages between two</div><div class="line">tasks, and Decaf, a runtime coordinating tasks within a workflow. It is possible</div><div class="line">to compile Bredala alone, Manala with Bredala, or Decaf with Manala and Bredala. </div><div class="line"></div><div class="line">The following command builds Decaf with the MPI transport method. We recommend saving this into a script and running the script:</div></div><!-- fragment --><p> cmake /path/to/decaf/source \ -DCMAKE_INSTALL_PREFIX=/path/to/decaf/install \ -Dtransport_mpi=on \ </p><div class="fragment"><div class="line">The following command builds Decaf with both CCI and MPI transport methods:</div></div><!-- fragment --><p> cmake .. \ -DCMAKE_INSTALL_PREFIX=/path/to/decaf/install \ -Dtransport_mpi=on \ -Dtransport_cci=on \ -DCCI_PREFIX:PATH=/path/to/cci/install # If CCI is not installed in a default path </p><div class="fragment"><div class="line">Then, make, install, and set environment variables:</div></div><!-- fragment --><p> make make install export DECAF_PREFIX=/path/to/decaf/install export LD_LIBRARY_PATH=/path/to/decaf/install/lib:$LD_LIBRARY_PATH </p><div class="fragment"><div class="line">(The syntax above is for Bash and Linux; other shells and unixes are similar;</div><div class="line">eg., the dynamic library path variable is ```DYLD_LIBRARY_PATH on Mac OSX```.</div><div class="line">You may consider setting the environment variables in .bashrc or .profile)</div><div class="line"></div><div class="line"># Testing the installation on a local machine</div><div class="line"></div><div class="line">Decaf provides several examples of simple workflows. Assuming Decaf was installed following the previous instructions, run the following commands:</div></div><!-- fragment --> <h1>Testing examples</h1>
<h1>All the examples should complete</h1>
<p>cd /path/to/Decaf/install/examples/direct python linear-2nodes.py ./linear2.sh</p>
<p>cd /path/to/Decaf/install/examples/direct python linear-3nodes.py ./linear3.sh</p>
<p>cd /path/to/Decaf/install/examples/direct python cycle-4nodes.py ./cycle.sh</p>
<h1>Testing CCI transport method</h1>
<h1>Available only if Decaf was compiled with transport_cci=on</h1>
<p>python linear-2nodes-cci.py ./linear2.sh</p>
<div class="fragment"><div class="line"># Testing the installation on a distributed machine</div><div class="line"></div><div class="line">Certain Python scripts from the examples take extra arguments to specify the</div><div class="line">number of cores and their respective hosts. The following gives an example to</div><div class="line">use the linear-2nodes examples in a distributed context:</div></div><!-- fragment --> <h1>The linear-2nodes requires 8 procs (4 prod, 2 link, 2 cons)</h1>
<p>cd /path/to/Decaf/install/examples/direct echo -e "node1\nnode1\nnode1\nnode1\nnode2\nnode2\nnode3\nnode3" &gt; hostfile.txt python linear-2nodes-topo1.py &ndash;np 8 &ndash;hostfile hostfile.txt ./linear2.sh </p><div class="fragment"><div class="line"># Using Decaf in your project:</div><div class="line"></div><div class="line">There are numerous examples in the</div><div class="line">[examples directory](https://bitbucket.org/tpeterka1/decaf/raw/master/examples) of how to</div><div class="line">write your source file(s). Briefly, you need to provide the following:</div><div class="line"></div><div class="line">- Functions for all producer and consumer nodes and dataflow links in your</div><div class="line">  workflow. The signature of producer and consumer nodes is up to the user;</div><div class="line">  dataflow links have the following function signature:</div><div class="line">```{.cpp}</div><div class="line">extern &quot;C&quot;</div><div class="line">{</div><div class="line">  int dflow(void* args,                       // custom arguments to the callback</div><div class="line">           Dataflow* dataflow,                // this dataflow</div><div class="line">           pConstructData in_data)            // input data on this dataflow</div><div class="line">  {</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><h1>Wrapping your project in Python</h1>
<p>The workflow can be hand-coded in C++, but the python instructions below describe an easier way to define the network. The Python program creates a JSON configuration file that Decaf reads.</p>
<p>A short Python script (eg. example.py) can be used to set workflow parameters and run the workflow. </p><div class="fragment"><div class="line"># a small 2-node example, just a producer and consumer</div><div class="line"></div><div class="line"># --- include the following 4 lines each time ---</div><div class="line"></div><div class="line">import networkx as nx</div><div class="line">import os</div><div class="line">import imp</div><div class="line">wf = imp.load_source(&#39;workflow&#39;, os.environ[&#39;DECAF_PREFIX&#39;] + &#39;/python/workflow.py&#39;)</div><div class="line"></div><div class="line"># --- set your options here ---</div><div class="line"></div><div class="line"># path to .so module for dataflow callback functions</div><div class="line">mod_path = os.environ[&#39;DECAF_PREFIX&#39;] + &#39;/examples/direct/mod_linear_2nodes.so&#39;</div><div class="line"></div><div class="line"># define workflow graph</div><div class="line"># 2-node workflow</div><div class="line">#</div><div class="line">#    prod (4 procs) -&gt; con (2 procs)</div><div class="line">#</div><div class="line">#  entire workflow takes 8 procs (2 dataflow procs between producer and consumer)</div><div class="line">#  dataflow can be overlapped, but currently all disjoint procs (simplest case)</div><div class="line"></div><div class="line">w = nx.DiGraph()</div><div class="line">w.add_node(&quot;prod&quot;, start_proc=0, nprocs=4, func=&#39;prod&#39;, cmdline=&#39;./linear_2nodes&#39;)</div><div class="line">w.add_node(&quot;con&quot;,  start_proc=6, nprocs=2, func=&#39;con&#39;, cmdline=&#39;./linear_2nodes&#39;)</div><div class="line">w.add_edge(&quot;prod&quot;, &quot;con&quot;, start_proc=4, nprocs=2, func=&#39;dflow&#39;, path=mod_path,</div><div class="line">           prod_dflow_redist=&#39;count&#39;, dflow_con_redist=&#39;count&#39;, cmdline=&#39;./linear_2nodes&#39;)</div><div class="line"></div><div class="line"># --- convert the nx graph into a workflow data structure and run the workflow ---</div><div class="line"></div><div class="line">wf.processGraph(w, &quot;linear2&quot;)</div></div><!-- fragment --><h1>Learning more about decaf:</h1>
<p>See the documents https://bitbucket.org/tpeterka1/decaf/wiki/public-docs/public-docs.md "here". </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
